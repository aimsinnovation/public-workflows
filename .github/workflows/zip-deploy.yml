name: Deploy via scm

on:
  workflow_dispatch:
    inputs: 
      scm_url:
        required: true
        type: string
      artifact_name: 
        required: true
        type: string
  workflow_call:
    inputs: 
      scm_url:
        required: true
        type: string
      artifact_name: 
        required: true
        type: string

jobs:
  deployment:
    runs-on: ubuntu-latest
    steps: 
    - name: "Download artifact"
      uses: actions/download-artifact@v3
      with:
        name: ${{ inputs.artifact_name }}

    - name: "Deploy azure"
      run: | 
        http_res=$(curl -s -v -w "%{http_code}" --location \
          --request POST ${{ inputs.scm_url }} \
          --header "Authorization: Basic ${{ secrets.ZIP_DEPLOY_GLOBAL_SCOPE_USER_CREDENTIALS }}" \
          --data-binary "@app.zip")

        [[ $http_res = "200" ]] && echo "Deployment successful" || exit 1;